import{r as l,j as e,B as d,P as E,a as k,b as D,c as m,T as B,L as v,F as L,W as R,C as T,d as u,e as F,A as U,R as I,f as C,g as A,h as P,i as W}from"./vendor-Dg-8WR0v.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))f(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&f(h)}).observe(document,{childList:!0,subtree:!0});function c(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function f(n){if(n.ep)return;n.ep=!0;const o=c(n);fetch(n.href,o)}})();const N="4fafc201-1fb5-459e-8fcc-c5c9c331914b",S="beb5483e-36e1-4688-b7f5-ea07361b26a8";function V(){const[a,i]=l.useState(null),[c,f]=l.useState([]),[n,o]=l.useState(""),h=async s=>{try{await d.connect(s,t=>g(t)),console.log("Connected to device",s),i(s),await p(s)}catch(t){console.error("Error while connecting to device:",t)}},p=async s=>{await d.startNotifications(s,N,S,t=>{console.log("Characteristic data received: ",t.getUint32(0,!0)),f(r=>[...r,t.getUint32(0,!0)]),o(r=>r+t.getUint32(0,!0)+`
`)})},g=s=>{console.log(`Device ${s} disconnected`),i(null)};l.useEffect(()=>{const s=async()=>{await d.initialize({androidNeverForLocation:!0}),await t()},t=async()=>{try{await d.requestLEScan({},r=>{console.log("Received new scan result",r)}),setTimeout(async()=>{await d.stopLEScan(),console.log("Stopped scanning")},5e3)}catch(r){console.error("Error while scanning for devices:",r)}};return s(),()=>{}},[]);const w=async()=>{try{const s=await d.requestDevice();await h(s.deviceId)}catch(s){console.error("Error while connecting to device:",s)}},j=async()=>{if(!a){console.error("No device connected");return}try{const t=new ArrayBuffer(20),r=new DataView(t);r.setUint8(0,1),await d.write(a,N,S,r),console.log("Server started")}catch(s){console.error("Error while starting server:",s)}},y=async()=>{if(!a){console.error("No device connected");return}try{const t=new ArrayBuffer(20),r=new DataView(t);r.setUint8(0,0),await d.write(a,N,S,r),console.log("Server stopped")}catch(s){console.error("Error while stopping server:",s)}};return e.jsxs("div",{className:"home",children:[e.jsx("h1",{children:"BLE Log Reader"}),a?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Connected to ",a.name]}),e.jsx("button",{onClick:j,children:"Start Server"}),e.jsx("button",{onClick:y,children:"Stop Server"})]}):e.jsx("button",{onClick:w,children:"Connect to Device"}),e.jsx("h2",{children:"Log:"}),e.jsx("textarea",{value:n,readOnly:!0,rows:10,cols:50})]})}function _(){l.useState("Not Connected");const[a,i]=l.useState(!1),[c,f]=l.useState(null),[n,o]=l.useState(null);l.useEffect(()=>{(async()=>{await h()&&await p()})()},[]);const h=async()=>{try{const t=await u.get("http://192.168.4.1/health");return t.status===200&&t.data?(i(!0),console.log("Device is connected and healthy:",t.data),!0):(i(!1),console.log("Device not reachable"),!1)}catch(t){return console.error("Error checking WiFi status:",t),i(!1),!1}},p=async()=>{try{const t=await u.get("http://192.168.4.1/health");f(t.data),console.log("Device info fetched:",t.data)}catch(t){console.error("Error fetching device info:",t)}},g=async()=>{if(!a){console.log("Not connected to WiFi.");return}try{await u.post("http://192.168.4.1/start"),console.log("Game session started")}catch(t){console.error("Error starting session:",t)}},w=async()=>{if(!a){console.log("Not connected to WiFi.");return}try{await u.post("http://192.168.4.1/stop"),console.log("Game session stopped")}catch(t){console.error("Error stopping session:",t)}},j=async()=>{if(!a){console.log("Not connected to WiFi.");return}try{await u.post("http://192.168.4.1/reset_imu"),console.log("IMU reset")}catch(t){console.error("Error resetting IMU:",t)}},y=async()=>{if(!a){console.log("Not connected to WiFi.");return}try{const t=await u.get("http://192.168.4.1/data",{responseType:"blob"}),r=new Blob([t.data],{type:"text/csv"}),x=document.createElement("a");x.href=URL.createObjectURL(r),x.download="device_data.csv",x.click(),console.log("CSV data downloaded")}catch(t){console.error("Error fetching CSV data:",t)}};function s(t){const r=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];let x=0,b=t;for(;b>=1024&&x<r.length-1;)b/=1024,x++;return`${b.toFixed(2)} ${r[x]}`}return e.jsxs(E,{className:"text-white",children:[e.jsx("div",{className:"bg-blue-500 p-4 rounded-b-3xl",children:e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-4xl font-bold dark:text-white",children:"Tennis Assistant"}),e.jsx("h2",{className:"text-2xl",children:a?"Connected":"Not Connected"}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(k,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xl",children:"100%"})]})]})}),e.jsxs(D,{className:"space-y-4 pb-20",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Game Session"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-300",children:"Enable to start a new game session. This will record new data and reset previous data."}),e.jsx(m,{large:!0,className:"w-full bg-blue-500 text-white mt-4",onClick:g,children:"START"}),e.jsx(m,{large:!0,className:"w-full bg-red-500 text-white mt-4",onClick:w,children:"STOP"}),e.jsx(m,{large:!0,className:"w-full bg-gray-500 text-white mt-4",onClick:j,children:"RESET IMU"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Device Info"}),c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between dark:text-gray-300",children:[e.jsx("span",{children:"Firmware Version"}),e.jsx("span",{className:"text-red-500",children:c.version})]}),e.jsxs("div",{className:"flex justify-between dark:text-gray-300",children:[e.jsx("span",{children:"Battery"}),e.jsxs("span",{children:[c.battery,"%"]})]}),e.jsxs("div",{className:"flex justify-between dark:text-gray-300",children:[e.jsx("span",{children:"SD Card (Free/Total)"}),e.jsx("span",{children:c.sd_card&&c.sd_card.includes("/")?e.jsx(e.Fragment,{children:c.sd_card.split("/").map((t,r)=>e.jsxs("span",{children:[s(Number(t.trim())),r===0?" / ":""]},r))}):e.jsx("span",{children:c.sd_card})})]})]}):e.jsx("span",{className:"text-gray-500",children:"No device info available."})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Download Latest Data"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-300",children:"Download the latest data from the device."}),e.jsx(m,{large:!0,className:"w-full bg-blue-500 text-white mt-4",onClick:y,children:"GET"})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg max-w-lg",children:[e.jsx("h2",{className:"text-xl font-bold",children:"CSV Data"}),e.jsx("pre",{className:"whitespace-pre-wrap",children:n}),e.jsx(m,{className:"mt-4 bg-red-500 text-white",onClick:()=>o(null),children:"Close"})]})}),e.jsxs(B,{top:!1,className:"left-0 bottom-0 fixed w-full mb-0",children:[e.jsxs(v,{className:"flex flex-col items-center",to:"/view",children:[e.jsx(L,{className:"w-6 h-6 dark:text-white"}),e.jsx("span",{className:"dark:text-gray-300",children:"Data"})]}),e.jsxs(v,{to:"",className:"flex flex-col items-center",children:[e.jsx(R,{className:"w-6 h-6 dark:text-white"}),e.jsx("span",{className:"dark:text-gray-300",children:"Settings"})]}),e.jsxs(v,{to:"",className:"flex flex-col items-center",children:[e.jsx(T,{className:"w-6 h-6 dark:text-white"}),e.jsx("span",{className:"dark:text-gray-300",children:"Profile"})]})]})]})}function O(){const[a,i]=l.useState("ios");return document.documentElement.classList.add("dark"),l.useLayoutEffect(()=>{if(window.location.href.includes("safe-areas")){const c=document.documentElement;c&&(c.style.setProperty("--k-safe-area-top",a==="ios"?"44px":"24px"),c.style.setProperty("--k-safe-area-bottom","34px"))}},[a]),e.jsx(F,{children:e.jsx(U,{safeAreas:!0,theme:a,children:e.jsxs(I,{children:[e.jsx(C,{path:"/",element:e.jsx(_,{})}),e.jsx(C,{path:"/view",element:e.jsx(V,{})})]})})})}A();P.createRoot(document.getElementById("app")).render(e.jsx(W.StrictMode,{children:e.jsx(O,{})}));
